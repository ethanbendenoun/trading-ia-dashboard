<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ü§ñ Trading IA Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:#0a0a0a; color:white; font-family:'Segoe UI',sans-serif; }
  .header { background:#111; padding:20px; text-align:center; border-bottom:2px solid #222; }
  .header h1 { font-size:1.8em; }
  .header p { color:#888; margin-top:5px; }
  .date { color:#00FF88; font-weight:bold; }
  .container { max-width:1400px; margin:0 auto; padding:20px; }
  .synthese { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; margin:20px 0; }
  .card { background:#111; border-radius:12px; padding:20px; text-align:center; border:1px solid #222; }
  .card .nb { font-size:3em; font-weight:bold; }
  .card .label { color:#888; margin-top:5px; }
  .achat { border-color:#00FF88 !important; }
  .achat .nb { color:#00FF88; }
  .vente { border-color:#FF4444 !important; }
  .vente .nb { color:#FF4444; }
  .neutre { border-color:#FFD700 !important; }
  .neutre .nb { color:#FFD700; }
  .top-signals { display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:20px 0; }
  .signal-card { background:#111; border-radius:12px; padding:20px; border:1px solid #222; }
  .signal-card h3 { color:#888; font-size:0.9em; margin-bottom:10px; }
  .signal-card .ticker { font-size:2em; font-weight:bold; }
  .signal-card .prob { font-size:1.1em; color:#888; margin-top:5px; }
  .chart-container { background:#111; border-radius:12px; padding:20px; margin:20px 0; border:1px solid #222; }
  .chart-container h2 { margin-bottom:15px; font-size:1.1em; }
  .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
  .signal-row { display:flex; align-items:center; justify-content:space-between; padding:12px 15px; margin:5px 0; border-radius:8px; background:#1a1a1a; }
  .signal-row .ticker-name { font-weight:bold; width:80px; }
  .signal-row .bar-container { flex:1; margin:0 15px; background:#222; border-radius:4px; height:8px; }
  .signal-row .bar { height:8px; border-radius:4px; }
  .signal-row .prob-text { width:50px; text-align:right; font-size:0.9em; }
  .signal-row .badge { padding:3px 10px; border-radius:20px; font-size:0.75em; font-weight:bold; width:70px; text-align:center; }
  .badge-achat { background:#00FF8833; color:#00FF88; border:1px solid #00FF88; }
  .badge-vente { background:#FF444433; color:#FF4444; border:1px solid #FF4444; }
  .badge-neutre { background:#FFD70033; color:#FFD700; border:1px solid #FFD700; }
  .footer { text-align:center; padding:30px; color:#444; font-size:0.85em; }
  .refresh-btn { background:#00FF88; color:#000; border:none; padding:10px 25px; border-radius:8px; cursor:pointer; font-weight:bold; font-size:1em; margin-top:10px; }
  .refresh-btn:hover { background:#00cc6a; }
  .loading { text-align:center; padding:50px; color:#888; }
  @media(max-width:768px) {
    .synthese { grid-template-columns:1fr; }
    .top-signals { grid-template-columns:1fr; }
    .grid-2 { grid-template-columns:1fr; }
  }
</style>
</head>
<body>

<div class="header">
  <h1>ü§ñ Trading IA ‚Äî Dashboard</h1>
  <p>Mise √† jour : <span class="date" id="date-update">Chargement...</span></p>
  <button class="refresh-btn" onclick="loadData()">üîÑ Actualiser</button>
</div>

<div class="container">
  <div id="content" class="loading">
    <p>‚è≥ Chargement des donn√©es...</p>
    <p style="margin-top:10px;color:#555;font-size:0.85em">
      Si rien ne s'affiche, v√©rifiez que rapport_latest.json est √† jour sur GitHub
    </p>
  </div>
</div>

<div class="footer">
  Trading IA Dashboard ‚Äî Donn√©es mises √† jour via Google Colab<br>
  ‚ö†Ô∏è √Ä titre informatif uniquement ‚Äî Pas un conseil financier
</div>

<script>
// ‚ö†Ô∏è REMPLACE PAR TON USERNAME GITHUB
const GITHUB_USER = 'ethanbendenoun';
const GITHUB_REPO = 'trading-ia-dashboard';
const JSON_URL    = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/rapport_latest.json`;

async function loadData() {
  try {
    const res  = await fetch(JSON_URL + '?t=' + Date.now());
    const data = await res.json();
    renderDashboard(data);
  } catch(e) {
    document.getElementById('content').innerHTML = `
      <div style="text-align:center;padding:50px;color:#FF4444">
        <p>‚ùå Impossible de charger les donn√©es</p>
        <p style="color:#888;margin-top:10px;font-size:0.85em">
          V√©rifiez que rapport_latest.json existe dans le repository
        </p>
      </div>`;
  }
}

function renderDashboard(data) {
  const signaux  = data.signaux;
  const resume   = data.resume;
  const achats   = signaux.filter(s => s.signal === 'ACHAT');
  const ventes   = signaux.filter(s => s.signal === 'VENTE');
  const neutres  = signaux.filter(s => s.signal === 'NEUTRE');

  document.getElementById('date-update').textContent = `${data.date} √† ${data.heure}`;

  document.getElementById('content').innerHTML = `

    <!-- Synth√®se -->
    <div class="synthese">
      <div class="card achat">
        <div class="nb">${resume.nb_achats}</div>
        <div class="label">üü¢ Signaux Achat</div>
      </div>
      <div class="card vente">
        <div class="nb">${resume.nb_ventes}</div>
        <div class="label">üî¥ Signaux Vente</div>
      </div>
      <div class="card neutre">
        <div class="nb">${resume.nb_neutres}</div>
        <div class="label">‚ö™ Neutres</div>
      </div>
    </div>

    <!-- Top signals -->
    <div class="top-signals">
      <div class="signal-card" style="border-color:#00FF88">
        <h3>üèÜ MEILLEURE OPPORTUNIT√â</h3>
        <div class="ticker" style="color:#00FF88">${resume.top_achat}</div>
        <div class="prob">${achats.length > 0 ? achats[0].prob_hausse.toFixed(1) + '% probabilit√© de hausse' : 'Aucun signal achat'}</div>
      </div>
      <div class="signal-card" style="border-color:#FF4444">
        <h3>‚ö†Ô∏è SIGNAL VENTE</h3>
        <div class="ticker" style="color:#FF4444">${resume.top_vente}</div>
        <div class="prob">${ventes.length > 0 ? ventes[ventes.length-1].prob_hausse.toFixed(1) + '% probabilit√© de hausse' : 'Aucun signal vente'}</div>
      </div>
    </div>

    <!-- Liste des signaux -->
    <div class="chart-container">
      <h2>üéØ Probabilit√©s de hausse ‚Äî Tous les actifs</h2>
      ${signaux.map(s => {
        const pct   = s.prob_hausse;
        const badge = s.signal === 'ACHAT' ? 'badge-achat' :
                      s.signal === 'VENTE' ? 'badge-vente' : 'badge-neutre';
        const color = s.signal === 'ACHAT' ? '#00FF88' :
                      s.signal === 'VENTE' ? '#FF4444' : '#FFD700';
        const width = Math.max(0, Math.min(100, (pct - 35) / 35 * 100));
        return `
          <div class="signal-row">
            <span class="ticker-name">${s.ticker}</span>
            <div class="bar-container">
              <div class="bar" style="width:${width}%;background:${color}"></div>
            </div>
            <span class="prob-text" style="color:${color}">${pct.toFixed(1)}%</span>
            <span class="badge ${badge}">${s.signal}</span>
          </div>`;
      }).join('')}
    </div>

    <!-- Indicateurs -->
    <div class="grid-2">
      <div class="chart-container">
        <h2>üìä RSI par actif</h2>
        <canvas id="rsiChart"></canvas>
      </div>
      <div class="chart-container">
        <h2>üöÄ Score Breakout</h2>
        <canvas id="boChart"></canvas>
      </div>
    </div>

    <!-- Performance -->
    <div class="chart-container">
      <h2>üìà Performance 1j / 5j / 20j (%)</h2>
      <canvas id="perfChart"></canvas>
    </div>
  `;

  // Charts
  const tickers = signaux.map(s => s.ticker);
  const rsiVals = signaux.map(s => s.rsi);
  const boVals  = signaux.map(s => s.bo_score);
  const ret1    = signaux.map(s => s.ret_1d);
  const ret5    = signaux.map(s => s.ret_5d);
  const ret20   = signaux.map(s => s.ret_20d);

  // RSI Chart
  new Chart(document.getElementById('rsiChart'), {
    type: 'bar',
    data: {
      labels: tickers,
      datasets: [{
        data: rsiVals,
        backgroundColor: rsiVals.map(r =>
          r > 70 ? '#FF4444' : r < 30 ? '#00FF88' : '#FFD700'),
      }]
    },
    options: {
      plugins: { legend: { display:false } },
      scales: {
        x: { ticks:{ color:'#888' }, grid:{ color:'#222' } },
        y: { ticks:{ color:'#888' }, grid:{ color:'#222' },
             min:0, max:100 }
      },
      annotation: { annotations: {
        line70: { type:'line', yMin:70, yMax:70, borderColor:'#FF4444', borderDash:[5,5] },
        line30: { type:'line', yMin:30, yMax:30, borderColor:'#00FF88', borderDash:[5,5] }
      }}
    }
  });

  // Breakout Chart
  new Chart(document.getElementById('boChart'), {
    type: 'bar',
    data: {
      labels: tickers,
      datasets: [{
        data: boVals,
        backgroundColor: boVals.map(b =>
          b > 30 ? '#00FF88' : b > 15 ? '#FFD700' : '#555'),
      }]
    },
    options: {
      plugins: { legend: { display:false } },
      scales: {
        x: { ticks:{ color:'#888' }, grid:{ color:'#222' } },
        y: { ticks:{ color:'#888' }, grid:{ color:'#222' }, min:0, max:100 }
      }
    }
  });

  // Performance Chart
  new Chart(document.getElementById('perfChart'), {
    type: 'bar',
    data: {
      labels: tickers,
      datasets: [
        { label:'1 jour',  data:ret1,  backgroundColor:'#00FF8888' },
        { label:'5 jours', data:ret5,  backgroundColor:'#FF6B3588' },
        { label:'20 jours',data:ret20, backgroundColor:'#FF69B488' },
      ]
    },
    options: {
      plugins: { legend:{ labels:{ color:'white' } } },
      scales: {
        x: { ticks:{ color:'#888' }, grid:{ color:'#222' } },
        y: { ticks:{ color:'#888' }, grid:{ color:'#222' } }
      }
    }
  });
}

loadData();
</script>
</body>
</html>
