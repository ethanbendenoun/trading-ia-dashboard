<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üöÄ Trading IA V2 ‚Äî Pro Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:#050505; color:#e0e0e0; font-family:'Inter', 'Segoe UI', sans-serif; }
  
  /* Header & Status Bar */
  .header { background:#0f0f0f; padding:25px; text-align:center; border-bottom:1px solid #1f1f1f; position: sticky; top:0; z-index:100; }
  .header h1 { font-size:1.6em; letter-spacing: 2px; text-transform: uppercase; color: #fff; }
  .status-bar { display: flex; justify-content: center; gap: 20px; margin-top: 10px; font-size: 0.85em; }
  .date { color:#00FF88; font-weight:bold; }
  
  .container { max-width:1400px; margin:0 auto; padding:20px; }
  
  /* Market Stress Gauge */
  .market-status { background: linear-gradient(90deg, #111, #1a1a1a); border-radius: 12px; padding: 15px; margin-bottom: 25px; border: 1px solid #333; display: flex; align-items: center; justify-content: space-between; }
  .stress-label { font-weight: bold; font-size: 0.9em; color: #888; }
  .stress-value { font-size: 1.2em; font-weight: bold; }

  /* Cards Grid */
  .synthese { display:grid; grid-template-columns:repeat(4,1fr); gap:15px; margin-bottom: 25px; }
  .card { background:#0f0f0f; border-radius:12px; padding:20px; text-align:center; border:1px solid #1f1f1f; transition: 0.3s; }
  .card .nb { font-size:2.5em; font-weight:bold; }
  .card .label { color:#666; font-size: 0.8em; text-transform: uppercase; margin-top:5px; }
  
  /* Trading Table V2 */
  .table-container { background:#0f0f0f; border-radius:12px; padding:20px; border:1px solid #1f1f1f; margin-bottom: 25px; overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th { text-align: left; padding: 12px; color: #666; font-size: 0.8em; border-bottom: 1px solid #222; }
  td { padding: 15px 12px; border-bottom: 1px solid #111; font-size: 0.95em; }
  
  /* Badges */
  .badge { padding:4px 12px; border-radius:4px; font-size:0.7em; font-weight:bold; text-transform: uppercase; }
  .bg-achat { background:#00FF8822; color:#00FF88; border:1px solid #00FF8844; }
  .bg-vente { background:#FF444422; color:#FF4444; border:1px solid #FF444444; }
  .bg-danger { background:#FF0000; color:#fff; animation: blink 1s infinite; }
  @keyframes blink { 50% { opacity: 0.5; } }

  /* Progress Bars */
  .risk-bar-bg { background: #222; height: 6px; border-radius: 3px; width: 100px; display: inline-block; vertical-align: middle; }
  .risk-bar-fill { height: 6px; border-radius: 3px; }

  .grid-2 { display:grid; grid-template-columns: 1.5fr 1fr; gap:20px; }
  .chart-container { background:#0f0f0f; border-radius:12px; padding:20px; border:1px solid #1f1f1f; }
  
  .refresh-btn { background:#00FF88; color:#000; border:none; padding:8px 20px; border-radius:6px; cursor:pointer; font-weight:bold; transition: 0.2s; }
  .refresh-btn:hover { transform: scale(1.05); background: #fff; }

  @media(max-width:1024px) { .synthese { grid-template-columns: 1fr 1fr; } .grid-2 { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<div class="header">
  <h1>ü§ñ TRADING IA ‚Äî ENSEMBLE V2</h1>
  <div class="status-bar">
    <span>Dernier Scan: <span class="date" id="date-update">...</span></span>
    <span>Mode: <span style="color:#00AAFF">Multi-Mod√®le (LSTM + XGB)</span></span>
  </div>
  <button class="refresh-btn" onclick="loadData()" style="margin-top:15px">üîÑ ACTUALISER LE TERMINAL</button>
</div>

<div class="container">
  <div class="market-status">
    <div class="stress-label">üõ°Ô∏è NIVEAU DE S√âCURIT√â DU MARCH√â</div>
    <div id="global-stress" class="stress-value">Analyse en cours...</div>
  </div>

  <div id="content">
    <div style="text-align:center; padding:100px; color:#555;">Chargement du moteur de pr√©diction...</div>
  </div>
</div>

<script>
const GITHUB_USER = 'ethanbendenoun';
const GITHUB_REPO = 'trading-ia-dashboard';
const JSON_URL    = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/rapport_latest.json`;

async function loadData() {
  try {
    const res = await fetch(JSON_URL + '?t=' + Date.now());
    const data = await res.json();
    renderDashboard(data);
  } catch(e) {
    console.error(e);
    document.getElementById('content').innerHTML = `<div style="color:#FF4444; text-align:center; padding:50px;">‚ùå Erreur de connexion au serveur GitHub.</div>`;
  }
}

function renderDashboard(data) {
  const signaux = data.signaux;
  const resume = data.resume;
  
  // Calcul du stress global
  const avgCrash = signaux.reduce((acc, s) => acc + (s.crash_risk || 0), 0) / signaux.length;
  const stressEl = document.getElementById('global-stress');
  stressEl.textContent = avgCrash < 20 ? '‚úÖ EXCELLENT' : avgCrash < 40 ? '‚ö†Ô∏è MOD√âR√â' : 'üö® RISQU√â';
  stressEl.style.color = avgCrash < 20 ? '#00FF88' : avgCrash < 40 ? '#FFD700' : '#FF4444';

  document.getElementById('date-update').textContent = `${data.heure}`;

  document.getElementById('content').innerHTML = `
    <div class="synthese">
      <div class="card" style="border-left: 4px solid #00FF88">
        <div class="nb" style="color:#00FF88">${resume.nb_achats}</div>
        <div class="label">Achats</div>
      </div>
      <div class="card" style="border-left: 4px solid #FF4444">
        <div class="nb" style="color:#FF4444">${resume.nb_ventes}</div>
        <div class="label">Ventes</div>
      </div>
      <div class="card" style="border-left: 4px solid #FF0000">
        <div class="nb" style="color:#FF0000">${signaux.filter(s => s.crash_risk > 50).length}</div>
        <div class="label">Dangers</div>
      </div>
      <div class="card" style="border-left: 4px solid #00AAFF">
        <div class="nb" style="color:#00AAFF">${resume.top_achat}</div>
        <div class="label">Top Pick</div>
      </div>
    </div>

    <div class="table-container">
      <h2>üìã PLAN DE TRADING ACTIF</h2>
      <table>
        <thead>
          <tr>
            <th>ACTIF</th>
            <th>SIGNAL</th>
            <th>CONFIANCE</th>
            <th>RISQUE CRASH</th>
            <th>PRIX ACTUEL</th>
            <th>STOP LOSS</th>
            <th>TAKE PROFIT</th>
            <th>SIZING</th>
          </tr>
        </thead>
        <tbody>
          ${signaux.map(s => {
            const isDanger = s.crash_risk > 50;
            const badgeClass = isDanger ? 'bg-danger' : (s.signal === 'ACHAT' ? 'bg-achat' : s.signal === 'VENTE' ? 'bg-vente' : '');
            const riskColor = s.crash_risk > 40 ? '#FF4444' : s.crash_risk > 20 ? '#FFD700' : '#00FF88';
            
            return `
              <tr>
                <td style="font-weight:bold; color:#fff;">${s.ticker}</td>
                <td><span class="badge ${badgeClass}">${isDanger ? 'üö® DANGER' : s.signal}</span></td>
                <td>${s.prob_hausse.toFixed(1)}%</td>
                <td>
                  <div class="risk-bar-bg"><div class="risk-bar-fill" style="width:${s.crash_risk}%; background:${riskColor}"></div></div>
                  <span style="font-size:0.8em; margin-left:5px; color:${riskColor}">${s.crash_risk.toFixed(0)}%</span>
                </td>
                <td style="color:#00AAFF">${s.prix || s.price || '-'}‚Ç¨</td>
                <td style="color:#FF4444">${s.stop_loss ? s.stop_loss.toFixed(2) : '-'}</td>
                <td style="color:#00FF88">${s.take_profit ? s.take_profit.toFixed(2) : '-'}</td>
                <td style="font-weight:bold;">${s.sizing ? s.sizing.toFixed(1)+'%' : '0%'}</td>
              </tr>
            `;
          }).join('')}
        </tbody>
      </table>
    </div>

    <div class="grid-2">
      <div class="chart-container">
        <h2>üìä ALLOCATION & PERFORMANCE RELATIVE</h2>
        <canvas id="sizingChart"></canvas>
      </div>
      <div class="chart-container">
        <h2>üî¨ MOMENTUM (RSI)</h2>
        <canvas id="rsiChart"></canvas>
      </div>
    </div>
  `;

  // --- Graphiques ---
  const tickers = signaux.map(s => s.ticker);
  
  // Chart Sizing
  new Chart(document.getElementById('sizingChart'), {
    type: 'bar',
    data: {
      labels: tickers,
      datasets: [{
        label: 'Sizing Recommand√© (%)',
        data: signaux.map(s => s.sizing),
        backgroundColor: '#00AAFF'
      }]
    },
    options: { plugins:{legend:{display:false}}, scales:{ y:{beginAtZero:true, grid:{color:'#111'}}, x:{grid:{display:false}} } }
  });

  // Chart RSI
  new Chart(document.getElementById('rsiChart'), {
    type: 'radar',
    data: {
      labels: tickers,
      datasets: [{
        label: 'RSI',
        data: signaux.map(s => s.rsi),
        borderColor: '#00FF88',
        backgroundColor: '#00FF8822'
      }]
    },
    options: { 
      scales: { r: { angleLines:{color:'#222'}, grid:{color:'#222'}, pointLabels:{color:'#888'}, min:0, max:100 } },
      plugins: { legend: { display:false } }
    }
  });
}

loadData();
</script>
</body>
</html>
